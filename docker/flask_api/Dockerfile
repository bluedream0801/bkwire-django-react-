FROM registry.gitlab.com/1337its/projects/bkwire/bkwire-api-docker AS flask-api

ARG PACER_USERNAME
ARG PACER_PASSWORD
ARG PACER_CLIENTCODE
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG MYSQL_DB_USER
ARG MYSQL_DB_PASSWORD

ENV PACER_USERNAME=$PACER_USERNAME
ENV PACER_PASSWORD=$PACER_PASSWORD
ENV PACER_CLIENTCODE=$PACER_CLIENTCODE
ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV MYSQL_DB_USER=$MYSQL_DB_USER
ENV MYSQL_DB_PASSWORD=$MYSQL_DB_PASSWORD

COPY . /app
WORKDIR /app
RUN mkdir -p logs results/pdf2png

RUN python3 -m pip install --upgrade pip
RUN python3 -m pip install -r requirements.txt
RUN python3 -m spacy download en_core_web_sm
EXPOSE 5000
